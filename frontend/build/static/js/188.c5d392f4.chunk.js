"use strict";(self.webpackChunkfrontends=self.webpackChunkfrontends||[]).push([[188],{66188:(e,s,r)=>{r.r(s),r.d(s,{default:()=>H});var t=r(65043),l=r(7353),o=r(94496),n=r(62559),a=r(17392),i=r(77739),c=r(11906),d=r(70378),u=r(32143),h=r(74605),x=r(23217),f=r(39336),m=r(2050),p=r(48734),j=r(72221),b=r(94109),A=r(68903),C=r(67784),y=r(83462),g=r(4219),w=r(35316),k=r(29347),S=r(79484),_=r(52879),v=r(47968),F=r(47805),z=r(88645),E=r(59540),I=r(37131),B=r(99389),L=r(30079),W=r(70141),D=r(83560),T=r(33438),P=r(37141),M=r(51387),R=r(26240),N=r(85442),$=r(13892),q=r(80899),O=r(11238),U=r(27415),Y=(r(68654),r(70579));const J="https://willowtonbursary.co.za/api",X=q.Ik({first_name:q.Yj().required("First name is required"),last_name:q.Yj().required("Last name is required"),email_address:q.Yj().email("Invalid email address").required("Email is required"),password:q.Yj().min(6,"Password should be at least 6 characters").required("Password is required"),user_type:q.Yj().required("Please select user type")}),H=()=>{var e;const{isDarkMode:s}=(0,t.useContext)(U.D),[r,q]=(0,t.useState)([]),[H,V]=(0,t.useState)(!1),[K,G]=(0,t.useState)(null),[Q,Z]=(0,t.useState)(!1),[ee,se]=(0,t.useState)(""),[re,te]=(0,t.useState)(["first_name","last_name","email_address","user_type"]),[le,oe]=(0,t.useState)(["first_name","last_name","email_address","user_type"]),[ne,ae]=(0,t.useState)({}),[ie,ce]=(0,t.useState)(null),[de,ue]=(0,t.useState)(!1),[he,xe]=(0,t.useState)({key:null,direction:null}),[fe,me]=(0,t.useState)(0),[pe,je]=(0,t.useState)(10),[be,Ae]=(0,t.useState)(""),[Ce,ye]=(0,t.useState)(0),ge=(0,t.useRef)(null),we=(0,t.useRef)(null),ke=Boolean(ie),Se=(0,R.A)(),_e=(0,N.A)(Se.breakpoints.down("sm")),ve=null===(e=JSON.parse(localStorage.getItem("user")))||void 0===e?void 0:e.user_type,Fe=(0,t.useCallback)((e=>e.replace(/_/g," ").replace(/\b\w/g,(e=>e.toUpperCase()))),[]),ze=(0,t.useCallback)((e=>{const s=10*Fe(e).length+40;return Math.max(50,s)}),[Fe]),Ee=(0,t.useCallback)((async()=>{var e;let s="admin"===ve?`${J}/users`:`${J}/users/${null===(e=JSON.parse(localStorage.getItem("user")))||void 0===e?void 0:e.user_id}`;try{const e=await fetch(s),r=await e.json(),t="admin"===ve?Array.isArray(r)?r:[]:[r];if(q(t),t.length>0){const e=["first_name","last_name","email_address","user_type"];te(e),oe(e),ae(e.reduce(((e,s)=>({...e,[s]:ze(s)})),{}))}}catch(r){console.error("Error fetching users:",r),q([])}}),[ve,ze]);(0,t.useEffect)((()=>{Ee()}),[Ee]),(0,t.useEffect)((()=>{const e=e=>{ge.current&&!ge.current.contains(e.target)&&ue(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]);const Ie=(0,t.useCallback)((e=>{if(we.current){const{col:s,startX:r,startWidth:t}=we.current,l=Math.max(50,t+(e.clientX-r));ae((e=>({...e,[s]:l})))}}),[]),Be=(0,t.useCallback)((()=>{we.current=null,document.removeEventListener("mousemove",Ie),document.removeEventListener("mouseup",Be),document.body.style.userSelect=""}),[Ie]),Le=(0,t.useCallback)(((e,s)=>{e.preventDefault(),we.current={col:s,startX:e.clientX,startWidth:ne[s]||ze(s)},document.addEventListener("mousemove",Ie),document.addEventListener("mouseup",Be),document.body.style.userSelect="none"}),[ne,ze,Ie,Be]),We=(0,$.Wx)({initialValues:{first_name:K?K.first_name:"",last_name:K?K.last_name:"",email_address:K?K.email_address:"",password:"",user_type:"admin"},validationSchema:X,enableReinitialize:!0,onSubmit:async e=>{try{const s=K?await fetch(`${J}/users/${K.user_id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}):await fetch(`${J}/users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(s.ok){const e=await s.json();q((s=>K?s.map((s=>s.user_id===e.user_id?e:s)):[...s,e])),V(!1)}else console.error("Failed to save data")}catch(s){console.error("Error saving user:",s)}}}),De=e=>{(async e=>{try{const s=await fetch(`${J}/users/${e}`),r=await s.json();G(r)}catch(s){console.error("Error fetching user by ID:",s)}})(e.user_id),V(!0)},Te=()=>{Z(!1)},Pe=()=>{V(!1)},Me=r.filter((e=>le.some((s=>{const r=e[s];return null!=r&&r.toString().toLowerCase().includes(ee.toLowerCase())})))).sort(((e,s)=>{if(!he.key||!he.direction)return 0;const r=e[he.key],t=s[he.key];return null==r||null==t?0:"asc"===he.direction?r.toString().localeCompare(t.toString()):t.toString().localeCompare(r.toString())})),Re=Me.slice(fe*pe,(fe+1)*pe);(0,t.useEffect)((()=>{ye(Me.length)}),[Me]);const Ne=re.filter((e=>{const s=be.toLowerCase(),r=e.toLowerCase(),t=Fe(e).toLowerCase();return r.includes(s)||t.includes(s)}));return(0,Y.jsxs)(l.A,{sx:{backgroundColor:s?"#2D3748":"#F7FAFC",minHeight:"100vh",p:2},className:s?"dark-mode":"",children:[(0,Y.jsxs)(l.A,{sx:{padding:"12px",backgroundColor:s?"#1e293b":"#e1f5fe",borderRadius:"8px",marginBottom:"12px",border:"1px solid #ccc",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Y.jsx)(o.A,{variant:"h6",sx:{color:s?"white":"black",fontWeight:"bold"},children:"User Information"}),(0,Y.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,Y.jsx)(l.A,{ref:ge,sx:{width:de?_e?120:220:0,height:36,overflow:"hidden",transition:"width 0.3s ease-in-out, opacity 0.3s ease-in-out",display:"flex",alignItems:"center",opacity:de?1:0},children:(0,Y.jsx)(n.Ay,{placeholder:"Search",value:ee,onChange:e=>{se(e.target.value),me(0)},sx:{backgroundColor:s?"#1e293b":"#fff",color:s?"white":"black",px:1.5,height:"100%",fontSize:"0.85rem",borderRadius:1,border:"1px solid "+(s?"#4A5568":"#CBD5E0"),width:"100%",minWidth:0},startAdornment:(0,Y.jsx)(S.A,{sx:{mr:1},fontSize:"small"}),endAdornment:ee&&(0,Y.jsx)(a.A,{size:"small",onClick:()=>{se(""),me(0)},sx:{color:s?"white":"black"},children:(0,Y.jsx)(L.A,{fontSize:"small"})})})}),(0,Y.jsx)(i.A,{title:de?"Close Search":"Search",children:(0,Y.jsx)(a.A,{size:"small",onClick:()=>ue((e=>!e)),sx:{color:s?"white":"black"},children:de?(0,Y.jsx)(L.A,{fontSize:"small"}):(0,Y.jsx)(S.A,{fontSize:"small"})})}),!(_e&&de)&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(o.A,{sx:{color:s?"white":"black",fontSize:"1rem"},children:"|"}),(0,Y.jsx)(i.A,{title:"Column Visibility",children:(0,Y.jsx)(a.A,{size:"small",onClick:e=>ce(e.currentTarget),sx:{color:s?"white":"black"},children:(0,Y.jsx)(_.A,{fontSize:"small"})})}),(0,Y.jsx)(o.A,{sx:{color:s?"white":"black",fontSize:"1rem"},children:"|"}),(0,Y.jsx)(i.A,{title:"Export to Excel",children:(0,Y.jsx)(a.A,{size:"small",onClick:()=>{const e=Me.map((e=>Object.fromEntries(le.map((s=>[Fe(s),e[s]]))))),s=O.Wp.json_to_sheet(e),r=O.Wp.book_new();O.Wp.book_append_sheet(r,s,"UserReport"),O._h(r,"user_report.xlsx")},sx:{color:s?"white":"black"},children:(0,Y.jsx)(v.A,{fontSize:"small"})})}),"admin"===ve&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(o.A,{sx:{color:s?"white":"black",fontSize:"1rem"},children:"|"}),(0,Y.jsx)(i.A,{title:"Create User",children:(0,Y.jsxs)(c.A,{variant:"contained",onClick:()=>{G(null),V(!0)},sx:{display:"flex",alignItems:"center",backgroundColor:s?"white":"black",color:s?"black":"white",padding:"2px 6px",textTransform:"none",fontSize:"0.85rem"},children:[(0,Y.jsx)(W.A,{sx:{mr:.5,fontSize:15}}),"Create"]})})]})]})]})]}),(0,Y.jsxs)(d.A,{anchorEl:ie,open:ke,onClose:()=>ce(null),PaperProps:{sx:{minWidth:200,maxHeight:300,p:1,backgroundColor:s?"#1e293b":"#fff",color:s?"#F7FAFC":"#1e293b",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.15)",borderRadius:2}},children:[(0,Y.jsx)(n.Ay,{autoFocus:!0,placeholder:"Search Columns",value:be,onChange:e=>Ae(e.target.value),onKeyDown:e=>e.stopPropagation(),sx:{mb:1,px:1,fontSize:"0.7rem",backgroundColor:s?"#334155":"#f1f5f9",borderRadius:1,width:"100%",height:"28px",color:s?"#F7FAFC":"#1e293b"}}),Ne.map((e=>(0,Y.jsx)(u.A,{dense:!0,children:(0,Y.jsx)(h.A,{control:(0,Y.jsx)(x.A,{size:"small",checked:le.includes(e),onChange:()=>(e=>{if(le.includes(e))oe((s=>s.filter((s=>s!==e))));else{const s=re.indexOf(e),r=[...le];r.splice(s,0,e),oe(r)}})(e)}),label:(0,Y.jsx)("span",{style:{fontSize:"0.7rem"},children:Fe(e)})})},e))),(0,Y.jsx)(f.A,{sx:{my:1}}),(0,Y.jsxs)(u.A,{dense:!0,onClick:()=>{oe(re),ae(re.reduce(((e,s)=>({...e,[s]:ze(s)})),{})),ce(null)},children:[(0,Y.jsx)(m.A,{children:(0,Y.jsx)(F.A,{fontSize:"small"})}),(0,Y.jsx)(p.A,{primary:"Reset Columns",primaryTypographyProps:{fontSize:"0.7rem"}})]})]}),(0,Y.jsx)("div",{className:"generic-table-container",children:(0,Y.jsxs)("table",{className:"generic-table",style:{backgroundColor:s?"#1e293b":"#fff",tableLayout:"fixed"},children:[(0,Y.jsx)("thead",{children:(0,Y.jsxs)("tr",{children:[(0,Y.jsx)("th",{style:{color:s?"white":"#1e293b",width:50,minWidth:50}}),le.map((e=>(0,Y.jsxs)("th",{style:{color:s?"white":"#1e293b",cursor:"pointer",position:"relative",width:ne[e]||ze(e),minWidth:50},onClick:s=>{"resize-handle"!==s.target.className&&(e=>{xe((s=>s.key===e?{key:e,direction:"asc"===s.direction?"desc":"desc"===s.direction?null:"asc"}:{key:e,direction:"asc"})),me(0)})(e)},children:[(0,Y.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:"10px"},children:[(0,Y.jsx)("span",{children:Fe(e)}),(0,Y.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[he.key===e&&"asc"===he.direction&&(0,Y.jsx)(E.A,{fontSize:"small"}),he.key===e&&"desc"===he.direction&&(0,Y.jsx)(z.A,{fontSize:"small"}),he.key===e&&null===he.direction]})]}),(0,Y.jsx)("span",{className:"resize-handle",onMouseDown:s=>Le(s,e),style:{position:"absolute",right:0,top:0,height:"100%",width:"5px",cursor:"col-resize",background:s?"#4A5568":"#CBD5E0",display:"flex",alignItems:"center",justifyContent:"center",userSelect:"none"},children:(0,Y.jsx)("span",{style:{fontSize:"12px",color:s?"#F7FAFC":"#1e293b"},children:"|"})})]},e)))]})}),(0,Y.jsx)("tbody",{children:Re.length>0?Re.map((e=>(0,Y.jsxs)("tr",{children:[(0,Y.jsx)("td",{style:{color:s?"white":"#1e293b",width:50,minWidth:50},children:(0,Y.jsx)(c.A,{onClick:()=>De(e),size:"small",sx:{color:s?"#F7FAFC":"#1E293B"},children:(0,Y.jsx)(D.A,{fontSize:"small"})})}),le.map((r=>{const t="user_type"===r;return(0,Y.jsx)("td",{style:{color:s?"white":"#1e293b",width:ne[r]||ze(r),minWidth:50,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t?(0,Y.jsx)("span",{style:{backgroundColor:"student"===e[r]?"#1e88e5":"admin"===e[r]?"#43a047":"#9e9e9e",color:"#fff",padding:"2px 8px",borderRadius:"12px",fontSize:"0.75rem",display:"inline-block",textTransform:"capitalize",whiteSpace:"nowrap"},children:e[r]}):e[r]},r)}))]},e.user_id))):(0,Y.jsx)("tr",{children:(0,Y.jsx)("td",{colSpan:le.length+1,className:"no-matching-records",children:"No matching records found"})})})]})}),(0,Y.jsx)(l.A,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:(0,Y.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:2,border:"1px solid",borderColor:s?"#4A5568":"#CBD5E0",borderRadius:"8px",padding:"6px 12px",backgroundColor:s?"#2D3748":"#F7FAFC",color:s?"#F7FAFC":"#1e293b"},children:[(0,Y.jsx)(o.A,{variant:"caption",sx:{whiteSpace:"nowrap"},children:"Rows per page:"}),(0,Y.jsx)(j.A,{value:pe,onChange:e=>{je(parseInt(e.target.value)),me(0)},size:"small",sx:{color:s?"#F7FAFC":"#1e293b",".MuiSelect-icon":{color:s?"#F7FAFC":"#1e293b"},backgroundColor:s?"#4A5568":"#E2E8F0",borderRadius:"4px",fontSize:"0.85rem",minWidth:"60px"},children:[10,15,25,50,100].map((e=>(0,Y.jsx)(u.A,{value:e,children:e},e)))}),(0,Y.jsxs)(o.A,{variant:"caption",sx:{whiteSpace:"nowrap"},children:[fe*pe+1,"-",Math.min((fe+1)*pe,Ce)," of ",Ce]}),(0,Y.jsx)(a.A,{onClick:()=>me((e=>Math.max(0,e-1))),disabled:0===fe,size:"small",sx:{color:s?"#F7FAFC":"#1e293b"},children:(0,Y.jsx)(I.A,{fontSize:"small"})}),(0,Y.jsx)(a.A,{onClick:()=>me((e=>(e+1)*pe<Ce?e+1:e)),disabled:(fe+1)*pe>=Ce,size:"small",sx:{color:s?"#F7FAFC":"#1e293b"},children:(0,Y.jsx)(B.A,{fontSize:"small"})})]})}),(0,Y.jsx)(b.Ay,{anchor:"right",open:H,onClose:Pe,children:(0,Y.jsxs)(l.A,{sx:{width:_e?330:500,height:"100%",display:"flex",flexDirection:"column",backgroundColor:s?"#2D3748":"#ffffff"},children:[(0,Y.jsx)(l.A,{sx:{p:2,borderBottom:"1px solid #ccc"},children:(0,Y.jsx)(o.A,{variant:"h6",sx:{color:s?"#F7FAFC":"#1E293B"},children:K?"Edit User":"Create User"})}),(0,Y.jsx)(l.A,{sx:{flex:1,overflowY:"auto",p:2},children:(0,Y.jsx)("form",{onSubmit:We.handleSubmit,children:(0,Y.jsxs)(A.Ay,{container:!0,spacing:2,children:[(0,Y.jsx)(A.Ay,{item:!0,xs:12,children:(0,Y.jsx)(C.A,{label:"First Name",fullWidth:!0,name:"first_name",value:We.values.first_name,onChange:We.handleChange,error:We.touched.first_name&&Boolean(We.errors.first_name),helperText:We.touched.first_name&&We.errors.first_name,sx:{backgroundColor:s?"#1A202C":"#ffffff","& .MuiInputBase-input":{color:s?"white":"#1e293b"}},InputLabelProps:{style:{color:s?"#ffffff":"#000000"}}})}),(0,Y.jsx)(A.Ay,{item:!0,xs:12,children:(0,Y.jsx)(C.A,{label:"Last Name",fullWidth:!0,name:"last_name",value:We.values.last_name,onChange:We.handleChange,error:We.touched.last_name&&Boolean(We.errors.last_name),helperText:We.touched.last_name&&We.errors.last_name,sx:{backgroundColor:s?"#1A202C":"#ffffff","& .MuiInputBase-input":{color:s?"white":"#1e293b"}},InputLabelProps:{style:{color:s?"#ffffff":"#000000"}}})}),(0,Y.jsx)(A.Ay,{item:!0,xs:12,children:(0,Y.jsx)(C.A,{label:"Email Address",fullWidth:!0,name:"email_address",value:We.values.email_address,onChange:We.handleChange,error:We.touched.email_address&&Boolean(We.errors.email_address),helperText:We.touched.email_address&&We.errors.email_address,sx:{backgroundColor:s?"#1A202C":"#ffffff","& .MuiInputBase-input":{color:s?"white":"#1e293b"}},InputLabelProps:{style:{color:s?"#ffffff":"#000000"}}})}),(0,Y.jsx)(A.Ay,{item:!0,xs:12,children:(0,Y.jsx)(C.A,{label:"Password",fullWidth:!0,name:"password",type:"password",value:We.values.password,onChange:We.handleChange,error:We.touched.password&&Boolean(We.errors.password),helperText:We.touched.password&&We.errors.password,sx:{backgroundColor:s?"#1A202C":"#ffffff","& .MuiInputBase-input":{color:s?"white":"#1e293b"}},InputLabelProps:{style:{color:s?"#ffffff":"#000000"}}})}),(0,Y.jsx)(A.Ay,{item:!0,xs:12,children:(0,Y.jsx)(C.A,{label:"User Type",value:K?K.user_type:"admin",disabled:!0,fullWidth:!0,sx:{backgroundColor:s?"#1A202C":"#ffffff","& .MuiInputBase-input":{color:s?"white":"#1E293B"},"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:s?"white":"#1E293B"}},InputLabelProps:{style:{color:s?"#ffffff":"#000000"}}})})]})})}),(0,Y.jsx)(f.A,{}),(0,Y.jsxs)(l.A,{sx:{p:2,display:"flex",justifyContent:"space-between",marginTop:"auto"},children:[(0,Y.jsxs)(l.A,{sx:{display:"flex",gap:1},children:[(0,Y.jsx)(c.A,{onClick:Pe,startIcon:(0,Y.jsx)(T.A,{}),size:"small",variant:"outlined",sx:{borderColor:s?"#F7FAFC":"#1E293B",color:s?"#F7FAFC":"#1E293B"},children:"Close"}),K&&"student"!==ve&&(0,Y.jsx)(c.A,{onClick:()=>{Z(!0)},startIcon:(0,Y.jsx)(M.A,{}),size:"small",color:"error",variant:"outlined",sx:{borderColor:s?"#F7FAFC":"#1E293B"},children:"Delete"})]}),(0,Y.jsx)(c.A,{onClick:We.handleSubmit,startIcon:K?(0,Y.jsx)(P.A,{}):(0,Y.jsx)(W.A,{}),variant:"contained",size:"small",sx:{backgroundColor:"#1976d2",color:"white"},children:K?"Save":"Create"})]})]})}),(0,Y.jsxs)(y.A,{open:Q,onClose:Te,children:[(0,Y.jsx)(g.A,{children:"Confirm Deletion"}),(0,Y.jsx)(w.A,{children:"Are you sure you want to delete this user?"}),(0,Y.jsxs)(k.A,{children:[(0,Y.jsx)(c.A,{onClick:Te,color:"primary",children:"Cancel"}),(0,Y.jsx)(c.A,{onClick:async()=>{if(K)try{await fetch(`${J}/users/${K.user_id}`,{method:"DELETE"}),q((e=>e.filter((e=>e.user_id!==K.user_id)))),Z(!1),V(!1)}catch(e){console.error("Failed to delete user:",e)}},color:"error",children:"Delete"})]})]})]})}},68654:()=>{}}]);
//# sourceMappingURL=188.c5d392f4.chunk.js.map