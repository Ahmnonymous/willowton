"use strict";(self.webpackChunkfrontends=self.webpackChunkfrontends||[]).push([[188],{66188:(e,s,r)=>{r.r(s),r.d(s,{default:()=>G});var t=r(89379),l=r(65043),n=r(7353),o=r(94496),a=r(62559),i=r(17392),c=r(77739),d=r(11906),u=r(70378),h=r(32143),x=r(74605),f=r(23217),m=r(39336),p=r(2050),A=r(48734),j=r(81637),b=r(72221),C=r(94109),y=r(68903),g=r(67784),w=r(83462),k=r(4219),S=r(35316),_=r(29347),F=r(79484),v=r(52879),z=r(47968),E=r(47805),I=r(88645),B=r(59540),L=r(37131),W=r(99389),D=r(30079),T=r(70141),P=r(83560),M=r(33438),N=r(37141),R=r(51387),q=r(26240),O=r(85442),U=r(13892),Y=r(80899),J=r(11238),X=r(27415),H=(r(68654),r(70579));const V="https://willowtonbursary.co.za/api",K=Y.Ik({first_name:Y.Yj().required("First name is required"),last_name:Y.Yj().required("Last name is required"),email_address:Y.Yj().email("Invalid email address").required("Email is required"),password:Y.Yj().min(6,"Password should be at least 6 characters").required("Password is required"),user_type:Y.Yj().required("Please select user type")}),G=()=>{var e;const{isDarkMode:s}=(0,l.useContext)(X.D),[r,Y]=(0,l.useState)([]),[G,Q]=(0,l.useState)(!1),[Z,$]=(0,l.useState)(null),[ee,se]=(0,l.useState)(!1),[re,te]=(0,l.useState)(""),[le,ne]=(0,l.useState)(["first_name","last_name","email_address","user_type"]),[oe,ae]=(0,l.useState)(["first_name","last_name","email_address","user_type"]),[ie,ce]=(0,l.useState)({}),[de,ue]=(0,l.useState)(null),[he,xe]=(0,l.useState)(!1),[fe,me]=(0,l.useState)({key:null,direction:null}),[pe,Ae]=(0,l.useState)(0),[je,be]=(0,l.useState)(10),[Ce,ye]=(0,l.useState)(""),[ge,we]=(0,l.useState)(0),[ke,Se]=(0,l.useState)(!1),_e=(0,l.useRef)(null),Fe=(0,l.useRef)(null),ve=Boolean(de),ze=(0,q.A)(),Ee=(0,O.A)(ze.breakpoints.down("sm")),Ie=null===(e=JSON.parse(localStorage.getItem("user")))||void 0===e?void 0:e.user_type,Be=(0,l.useCallback)((e=>e.replace(/_/g," ").replace(/\b\w/g,(e=>e.toUpperCase()))),[]),Le=(0,l.useCallback)((e=>{const s=10*Be(e).length+40;return Math.max(50,s)}),[Be]),We=(0,l.useCallback)((async()=>{var e;Se(!0);let s="admin"===Ie?"".concat(V,"/users"):"".concat(V,"/users/").concat(null===(e=JSON.parse(localStorage.getItem("user")))||void 0===e?void 0:e.user_id);try{const e=await fetch(s),r=await e.json(),l="admin"===Ie?Array.isArray(r)?r:[]:[r];if(Y(l),l.length>0){const e=["first_name","last_name","email_address","user_type"];ne(e),ae(e),ce(e.reduce(((e,s)=>(0,t.A)((0,t.A)({},e),{},{[s]:Le(s)})),{}))}}catch(r){console.error("Error fetching users:",r),Y([])}finally{Se(!1)}}),[Ie,Le]);(0,l.useEffect)((()=>{We()}),[We]),(0,l.useEffect)((()=>{const e=e=>{_e.current&&!_e.current.contains(e.target)&&xe(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]);const De=(0,l.useCallback)((e=>{if(Fe.current){const{col:s,startX:r,startWidth:l}=Fe.current,n=Math.max(50,l+(e.clientX-r));ce((e=>(0,t.A)((0,t.A)({},e),{},{[s]:n})))}}),[]),Te=(0,l.useCallback)((()=>{Fe.current=null,document.removeEventListener("mousemove",De),document.removeEventListener("mouseup",Te),document.body.style.userSelect=""}),[De]),Pe=(0,l.useCallback)(((e,s)=>{e.preventDefault(),Fe.current={col:s,startX:e.clientX,startWidth:ie[s]||Le(s)},document.addEventListener("mousemove",De),document.addEventListener("mouseup",Te),document.body.style.userSelect="none"}),[ie,Le,De,Te]),Me=(0,U.Wx)({initialValues:{first_name:Z?Z.first_name:"",last_name:Z?Z.last_name:"",email_address:Z?Z.email_address:"",password:"",user_type:"admin"},validationSchema:K,enableReinitialize:!0,onSubmit:async e=>{Se(!0);try{const s=Z?await fetch("".concat(V,"/users/").concat(Z.user_id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}):await fetch("".concat(V,"/users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(s.ok){const e=await s.json();Y((s=>Z?s.map((s=>s.user_id===e.user_id?e:s)):[...s,e])),Q(!1)}else console.error("Failed to save data")}catch(s){console.error("Error saving user:",s)}finally{Se(!1)}}}),Ne=e=>{(async e=>{Se(!0);try{const s=await fetch("".concat(V,"/users/").concat(e)),r=await s.json();$(r)}catch(s){console.error("Error fetching user by ID:",s)}finally{Se(!1)}})(e.user_id),Q(!0)},Re=()=>{se(!1)},qe=()=>{Q(!1)},Oe=r.filter((e=>oe.some((s=>{const r=e[s];return null!=r&&r.toString().toLowerCase().includes(re.toLowerCase())})))).sort(((e,s)=>{if(!fe.key||!fe.direction)return 0;const r=e[fe.key],t=s[fe.key];return null==r||null==t?0:"asc"===fe.direction?r.toString().localeCompare(t.toString()):t.toString().localeCompare(r.toString())})),Ue=Oe.slice(pe*je,(pe+1)*je);(0,l.useEffect)((()=>{we(Oe.length)}),[Oe]);const Ye=le.filter((e=>{const s=Ce.toLowerCase(),r=e.toLowerCase(),t=Be(e).toLowerCase();return r.includes(s)||t.includes(s)}));return(0,H.jsxs)(n.A,{sx:{backgroundColor:s?"#2D3748":"#F7FAFC",minHeight:"100vh",p:2},className:s?"dark-mode":"",children:[(0,H.jsxs)(n.A,{sx:{padding:"12px",backgroundColor:s?"#1e293b":"#e1f5fe",borderRadius:"8px",marginBottom:"12px",border:"1px solid #ccc",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,H.jsx)(o.A,{variant:"h6",sx:{color:s?"white":"black",fontWeight:"bold"},children:"User Information"}),(0,H.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,H.jsx)(n.A,{ref:_e,sx:{width:he?Ee?120:220:0,height:36,overflow:"hidden",transition:"width 0.3s ease-in-out, opacity 0.3s ease-in-out",display:"flex",alignItems:"center",opacity:he?1:0},children:(0,H.jsx)(a.Ay,{placeholder:"Search",value:re,onChange:e=>{te(e.target.value),Ae(0)},sx:{backgroundColor:s?"#1e293b":"#fff",color:s?"white":"black",px:1.5,height:"100%",fontSize:"0.85rem",borderRadius:1,border:"1px solid ".concat(s?"#4A5568":"#CBD5E0"),width:"100%",minWidth:0},startAdornment:(0,H.jsx)(F.A,{sx:{mr:1},fontSize:"small"}),endAdornment:re&&(0,H.jsx)(i.A,{size:"small",onClick:()=>{te(""),Ae(0)},sx:{color:s?"white":"black"},children:(0,H.jsx)(D.A,{fontSize:"small"})})})}),(0,H.jsx)(c.A,{title:he?"Close Search":"Search",children:(0,H.jsx)(i.A,{size:"small",onClick:()=>xe((e=>!e)),sx:{color:s?"white":"black"},children:he?(0,H.jsx)(D.A,{fontSize:"small"}):(0,H.jsx)(F.A,{fontSize:"small"})})}),!(Ee&&he)&&(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(o.A,{sx:{color:s?"white":"black",fontSize:"1rem"},children:"|"}),(0,H.jsx)(c.A,{title:"Column Visibility",children:(0,H.jsx)(i.A,{size:"small",onClick:e=>ue(e.currentTarget),sx:{color:s?"white":"black"},children:(0,H.jsx)(v.A,{fontSize:"small"})})}),(0,H.jsx)(o.A,{sx:{color:s?"white":"black",fontSize:"1rem"},children:"|"}),(0,H.jsx)(c.A,{title:"Export to Excel",children:(0,H.jsx)(i.A,{size:"small",onClick:()=>{const e=Oe.map((e=>Object.fromEntries(oe.map((s=>[Be(s),e[s]]))))),s=J.Wp.json_to_sheet(e),r=J.Wp.book_new();J.Wp.book_append_sheet(r,s,"UserReport"),J._h(r,"user_report.xlsx")},sx:{color:s?"white":"black"},children:(0,H.jsx)(z.A,{fontSize:"small"})})}),"admin"===Ie&&(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(o.A,{sx:{color:s?"white":"black",fontSize:"1rem"},children:"|"}),(0,H.jsx)(c.A,{title:"Create User",children:(0,H.jsxs)(d.A,{variant:"contained",onClick:()=>{$(null),Q(!0)},sx:{display:"flex",alignItems:"center",backgroundColor:s?"white":"black",color:s?"black":"white",padding:"2px 6px",textTransform:"none",fontSize:"0.85rem"},children:[(0,H.jsx)(T.A,{sx:{mr:.5,fontSize:15}}),"Create"]})})]})]})]})]}),(0,H.jsxs)(u.A,{anchorEl:de,open:ve,onClose:()=>ue(null),PaperProps:{sx:{minWidth:200,maxHeight:300,p:1,backgroundColor:s?"#1e293b":"#fff",color:s?"#F7FAFC":"#1e293b",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.15)",borderRadius:2}},children:[(0,H.jsx)(a.Ay,{autoFocus:!0,placeholder:"Search Columns",value:Ce,onChange:e=>ye(e.target.value),onKeyDown:e=>e.stopPropagation(),sx:{mb:1,px:1,fontSize:"0.7rem",backgroundColor:s?"#334155":"#f1f5f9",borderRadius:1,width:"100%",height:"28px",color:s?"#F7FAFC":"#1e293b"}}),Ye.map((e=>(0,H.jsx)(h.A,{dense:!0,children:(0,H.jsx)(x.A,{control:(0,H.jsx)(f.A,{size:"small",checked:oe.includes(e),onChange:()=>(e=>{if(oe.includes(e))ae((s=>s.filter((s=>s!==e))));else{const s=le.indexOf(e),r=[...oe];r.splice(s,0,e),ae(r)}})(e)}),label:(0,H.jsx)("span",{style:{fontSize:"0.7rem"},children:Be(e)})})},e))),(0,H.jsx)(m.A,{sx:{my:1}}),(0,H.jsxs)(h.A,{dense:!0,onClick:()=>{ae(le),ce(le.reduce(((e,s)=>(0,t.A)((0,t.A)({},e),{},{[s]:Le(s)})),{})),ue(null)},children:[(0,H.jsx)(p.A,{children:(0,H.jsx)(E.A,{fontSize:"small"})}),(0,H.jsx)(A.A,{primary:"Reset Columns",primaryTypographyProps:{fontSize:"0.7rem"}})]})]}),(0,H.jsx)("div",{className:"generic-table-container",children:ke?(0,H.jsx)(n.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px"},children:(0,H.jsx)(j.A,{sx:{color:s?"#F7FAFC":"#1e293b"}})}):(0,H.jsxs)("table",{className:"generic-table",style:{backgroundColor:s?"#1e293b":"#fff",tableLayout:"fixed"},children:[(0,H.jsx)("thead",{children:(0,H.jsxs)("tr",{children:[(0,H.jsx)("th",{style:{color:s?"white":"#1e293b",width:50,minWidth:50}}),oe.map((e=>(0,H.jsxs)("th",{style:{color:s?"white":"#1e293b",cursor:"pointer",position:"relative",width:ie[e]||Le(e),minWidth:50},onClick:s=>{"resize-handle"!==s.target.className&&(e=>{me((s=>s.key===e?{key:e,direction:"asc"===s.direction?"desc":"desc"===s.direction?null:"asc"}:{key:e,direction:"asc"})),Ae(0)})(e)},children:[(0,H.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:"10px"},children:[(0,H.jsx)("span",{children:Be(e)}),(0,H.jsxs)(n.A,{sx:{display:"flex",alignItems:"center"},children:[fe.key===e&&"asc"===fe.direction&&(0,H.jsx)(B.A,{fontSize:"small"}),fe.key===e&&"desc"===fe.direction&&(0,H.jsx)(I.A,{fontSize:"small"}),fe.key===e&&null===fe.direction]})]}),(0,H.jsx)("span",{className:"resize-handle",onMouseDown:s=>Pe(s,e),style:{position:"absolute",right:0,top:0,height:"100%",width:"5px",cursor:"col-resize",background:s?"#4A5568":"#CBD5E0",display:"flex",alignItems:"center",justifyContent:"center",userSelect:"none"},children:(0,H.jsx)("span",{style:{fontSize:"12px",color:s?"#F7FAFC":"#1e293b"},children:"|"})})]},e)))]})}),(0,H.jsx)("tbody",{children:Ue.length>0?Ue.map((e=>(0,H.jsxs)("tr",{children:[(0,H.jsx)("td",{style:{color:s?"white":"#1e293b",width:50,minWidth:50},children:(0,H.jsx)(d.A,{onClick:()=>Ne(e),size:"small",sx:{color:s?"#F7FAFC":"#1E293B"},children:(0,H.jsx)(P.A,{fontSize:"small"})})}),oe.map((r=>{const t="user_type"===r;return(0,H.jsx)("td",{style:{color:s?"white":"#1e293b",width:ie[r]||Le(r),minWidth:50,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t?(0,H.jsx)("span",{style:{backgroundColor:"student"===e[r]?"#1e88e5":"admin"===e[r]?"#43a047":"#9e9e9e",color:"#fff",padding:"2px 8px",borderRadius:"12px",fontSize:"0.75rem",display:"inline-block",textTransform:"capitalize",whiteSpace:"nowrap"},children:e[r]}):e[r]},r)}))]},e.user_id))):(0,H.jsx)("tr",{children:(0,H.jsx)("td",{colSpan:oe.length+1,className:"no-matching-records",children:0===r.length?"No records found":"No matching records found"})})})]})}),!ke&&(0,H.jsx)(n.A,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:(0,H.jsxs)(n.A,{sx:{display:"flex",alignItems:"center",gap:2,border:"1px solid",borderColor:s?"#4A5568":"#CBD5E0",borderRadius:"8px",padding:"6px 12px",backgroundColor:s?"#2D3748":"#F7FAFC",color:s?"#F7FAFC":"#1e293b"},children:[(0,H.jsx)(o.A,{variant:"caption",sx:{whiteSpace:"nowrap"},children:"Rows per page:"}),(0,H.jsx)(b.A,{value:je,onChange:e=>{be(parseInt(e.target.value)),Ae(0)},size:"small",sx:{color:s?"#F7FAFC":"#1e293b",".MuiSelect-icon":{color:s?"#F7FAFC":"#1e293b"},backgroundColor:s?"#4A5568":"#E2E8F0",borderRadius:"4px",fontSize:"0.85rem",minWidth:"60px"},children:[10,15,25,50,100].map((e=>(0,H.jsx)(h.A,{value:e,children:e},e)))}),(0,H.jsxs)(o.A,{variant:"caption",sx:{whiteSpace:"nowrap"},children:[pe*je+1,"-",Math.min((pe+1)*je,ge)," of ",ge]}),(0,H.jsx)(i.A,{onClick:()=>Ae((e=>Math.max(0,e-1))),disabled:0===pe,size:"small",sx:{color:s?"#F7FAFC":"#1e293b"},children:(0,H.jsx)(L.A,{fontSize:"small"})}),(0,H.jsx)(i.A,{onClick:()=>Ae((e=>(e+1)*je<ge?e+1:e)),disabled:(pe+1)*je>=ge,size:"small",sx:{color:s?"#F7FAFC":"#1e293b"},children:(0,H.jsx)(W.A,{fontSize:"small"})})]})}),(0,H.jsx)(C.Ay,{anchor:"right",open:G,onClose:qe,children:(0,H.jsxs)(n.A,{sx:{width:Ee?330:500,height:"100%",display:"flex",flexDirection:"column",backgroundColor:s?"#2D3748":"#ffffff"},children:[(0,H.jsx)(n.A,{sx:{p:2,borderBottom:"1px solid #ccc"},children:(0,H.jsx)(o.A,{variant:"h6",sx:{color:s?"#F7FAFC":"#1E293B"},children:Z?"Edit User":"Create User"})}),(0,H.jsx)(n.A,{sx:{flex:1,overflowY:"auto",p:2},children:(0,H.jsx)("form",{onSubmit:Me.handleSubmit,children:(0,H.jsxs)(y.Ay,{container:!0,spacing:2,children:[(0,H.jsx)(y.Ay,{item:!0,xs:12,children:(0,H.jsx)(g.A,{label:"First Name",fullWidth:!0,name:"first_name",value:Me.values.first_name,onChange:Me.handleChange,error:Me.touched.first_name&&Boolean(Me.errors.first_name),helperText:Me.touched.first_name&&Me.errors.first_name,sx:{backgroundColor:s?"#1A202C":"#ffffff","& .MuiInputBase-input":{color:s?"white":"#1e293b"}},InputLabelProps:{style:{color:s?"#ffffff":"#000000"}}})}),(0,H.jsx)(y.Ay,{item:!0,xs:12,children:(0,H.jsx)(g.A,{label:"Last Name",fullWidth:!0,name:"last_name",value:Me.values.last_name,onChange:Me.handleChange,error:Me.touched.last_name&&Boolean(Me.errors.last_name),helperText:Me.touched.last_name&&Me.errors.last_name,sx:{backgroundColor:s?"#1A202C":"#ffffff","& .MuiInputBase-input":{color:s?"white":"#1e293b"}},InputLabelProps:{style:{color:s?"#ffffff":"#000000"}}})}),(0,H.jsx)(y.Ay,{item:!0,xs:12,children:(0,H.jsx)(g.A,{label:"Email Address",fullWidth:!0,name:"email_address",value:Me.values.email_address,onChange:Me.handleChange,error:Me.touched.email_address&&Boolean(Me.errors.email_address),helperText:Me.touched.email_address&&Me.errors.email_address,sx:{backgroundColor:s?"#1A202C":"#ffffff","& .MuiInputBase-input":{color:s?"white":"#1e293b"}},InputLabelProps:{style:{color:s?"#ffffff":"#000000"}}})}),(0,H.jsx)(y.Ay,{item:!0,xs:12,children:(0,H.jsx)(g.A,{label:"Password",fullWidth:!0,name:"password",type:"password",value:Me.values.password,onChange:Me.handleChange,error:Me.touched.password&&Boolean(Me.errors.password),helperText:Me.touched.password&&Me.errors.password,sx:{backgroundColor:s?"#1A202C":"#ffffff","& .MuiInputBase-input":{color:s?"white":"#1e293b"}},InputLabelProps:{style:{color:s?"#ffffff":"#000000"}}})}),(0,H.jsx)(y.Ay,{item:!0,xs:12,children:(0,H.jsx)(g.A,{label:"User Type",value:Z?Z.user_type:"admin",disabled:!0,fullWidth:!0,sx:{backgroundColor:s?"#1A202C":"#ffffff","& .MuiInputBase-input":{color:s?"white":"#1E293B"},"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:s?"white":"#1E293B"}},InputLabelProps:{style:{color:s?"#ffffff":"#000000"}}})})]})})}),(0,H.jsx)(m.A,{}),(0,H.jsxs)(n.A,{sx:{p:2,display:"flex",justifyContent:"space-between",marginTop:"auto"},children:[(0,H.jsxs)(n.A,{sx:{display:"flex",gap:1},children:[(0,H.jsx)(d.A,{onClick:qe,startIcon:(0,H.jsx)(M.A,{}),size:"small",variant:"outlined",sx:{borderColor:s?"#F7FAFC":"#1E293B",color:s?"#F7FAFC":"#1E293B"},children:"Close"}),Z&&"student"!==Ie&&(0,H.jsx)(d.A,{onClick:()=>{se(!0)},startIcon:(0,H.jsx)(R.A,{}),size:"small",color:"error",variant:"outlined",sx:{borderColor:s?"#F7FAFC":"#1E293B"},children:"Delete"})]}),(0,H.jsx)(d.A,{onClick:Me.handleSubmit,startIcon:Z?(0,H.jsx)(N.A,{}):(0,H.jsx)(T.A,{}),variant:"contained",size:"small",sx:{backgroundColor:"#1976d2",color:"white"},children:Z?"Save":"Create"})]})]})}),(0,H.jsxs)(w.A,{open:ee,onClose:Re,children:[(0,H.jsx)(k.A,{children:"Confirm Deletion"}),(0,H.jsx)(S.A,{children:"Are you sure you want to delete this user?"}),(0,H.jsxs)(_.A,{children:[(0,H.jsx)(d.A,{onClick:Re,color:"primary",children:"Cancel"}),(0,H.jsx)(d.A,{onClick:async()=>{if(Z){Se(!0);try{await fetch("".concat(V,"/users/").concat(Z.user_id),{method:"DELETE"}),Y((e=>e.filter((e=>e.user_id!==Z.user_id)))),se(!1),Q(!1)}catch(e){console.error("Failed to delete user:",e)}finally{Se(!1)}}},color:"error",children:"Delete"})]})]})]})}},68654:()=>{}}]);
//# sourceMappingURL=188.bf401392.chunk.js.map