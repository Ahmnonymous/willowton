"use strict";(self.webpackChunkfrontends=self.webpackChunkfrontends||[]).push([[188],{66188:(e,s,r)=>{r.r(s),r.d(s,{default:()=>V});var t=r(65043),l=r(7353),n=r(94496),o=r(62559),a=r(17392),i=r(77739),c=r(11906),d=r(70378),u=r(32143),h=r(74605),x=r(23217),f=r(39336),m=r(2050),p=r(48734),j=r(81637),b=r(72221),A=r(94109),C=r(68903),y=r(67784),g=r(83462),w=r(4219),k=r(35316),S=r(29347),_=r(79484),F=r(52879),v=r(47968),z=r(47805),E=r(88645),I=r(59540),B=r(37131),L=r(99389),W=r(30079),D=r(70141),T=r(83560),P=r(33438),M=r(37141),N=r(51387),R=r(26240),$=r(85442),q=r(13892),O=r(80899),U=r(11238),Y=r(27415),J=(r(68654),r(70579));const X="https://willowtonbursary.co.za/api",H=O.Ik({first_name:O.Yj().required("First name is required"),last_name:O.Yj().required("Last name is required"),email_address:O.Yj().email("Invalid email address").required("Email is required"),password:O.Yj().min(6,"Password should be at least 6 characters").required("Password is required"),user_type:O.Yj().required("Please select user type")}),V=()=>{var e;const{isDarkMode:s}=(0,t.useContext)(Y.D),[r,O]=(0,t.useState)([]),[V,K]=(0,t.useState)(!1),[G,Q]=(0,t.useState)(null),[Z,ee]=(0,t.useState)(!1),[se,re]=(0,t.useState)(""),[te,le]=(0,t.useState)(["first_name","last_name","email_address","user_type"]),[ne,oe]=(0,t.useState)(["first_name","last_name","email_address","user_type"]),[ae,ie]=(0,t.useState)({}),[ce,de]=(0,t.useState)(null),[ue,he]=(0,t.useState)(!1),[xe,fe]=(0,t.useState)({key:null,direction:null}),[me,pe]=(0,t.useState)(0),[je,be]=(0,t.useState)(10),[Ae,Ce]=(0,t.useState)(""),[ye,ge]=(0,t.useState)(0),[we,ke]=(0,t.useState)(!1),Se=(0,t.useRef)(null),_e=(0,t.useRef)(null),Fe=Boolean(ce),ve=(0,R.A)(),ze=(0,$.A)(ve.breakpoints.down("sm")),Ee=null===(e=JSON.parse(localStorage.getItem("user")))||void 0===e?void 0:e.user_type,Ie=(0,t.useCallback)((e=>e.replace(/_/g," ").replace(/\b\w/g,(e=>e.toUpperCase()))),[]),Be=(0,t.useCallback)((e=>{const s=10*Ie(e).length+40;return Math.max(50,s)}),[Ie]),Le=(0,t.useCallback)((async()=>{var e;ke(!0);let s="admin"===Ee?`${X}/users`:`${X}/users/${null===(e=JSON.parse(localStorage.getItem("user")))||void 0===e?void 0:e.user_id}`;try{const e=await fetch(s),r=await e.json(),t="admin"===Ee?Array.isArray(r)?r:[]:[r];if(O(t),t.length>0){const e=["first_name","last_name","email_address","user_type"];le(e),oe(e),ie(e.reduce(((e,s)=>({...e,[s]:Be(s)})),{}))}}catch(r){console.error("Error fetching users:",r),O([])}finally{ke(!1)}}),[Ee,Be]);(0,t.useEffect)((()=>{Le()}),[Le]),(0,t.useEffect)((()=>{const e=e=>{Se.current&&!Se.current.contains(e.target)&&he(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]);const We=(0,t.useCallback)((e=>{if(_e.current){const{col:s,startX:r,startWidth:t}=_e.current,l=Math.max(50,t+(e.clientX-r));ie((e=>({...e,[s]:l})))}}),[]),De=(0,t.useCallback)((()=>{_e.current=null,document.removeEventListener("mousemove",We),document.removeEventListener("mouseup",De),document.body.style.userSelect=""}),[We]),Te=(0,t.useCallback)(((e,s)=>{e.preventDefault(),_e.current={col:s,startX:e.clientX,startWidth:ae[s]||Be(s)},document.addEventListener("mousemove",We),document.addEventListener("mouseup",De),document.body.style.userSelect="none"}),[ae,Be,We,De]),Pe=(0,q.Wx)({initialValues:{first_name:G?G.first_name:"",last_name:G?G.last_name:"",email_address:G?G.email_address:"",password:"",user_type:"admin"},validationSchema:H,enableReinitialize:!0,onSubmit:async e=>{ke(!0);try{const s=G?await fetch(`${X}/users/${G.user_id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}):await fetch(`${X}/users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(s.ok){const e=await s.json();O((s=>G?s.map((s=>s.user_id===e.user_id?e:s)):[...s,e])),K(!1)}else console.error("Failed to save data")}catch(s){console.error("Error saving user:",s)}finally{ke(!1)}}}),Me=e=>{(async e=>{ke(!0);try{const s=await fetch(`${X}/users/${e}`),r=await s.json();Q(r)}catch(s){console.error("Error fetching user by ID:",s)}finally{ke(!1)}})(e.user_id),K(!0)},Ne=()=>{ee(!1)},Re=()=>{K(!1)},$e=r.filter((e=>ne.some((s=>{const r=e[s];return null!=r&&r.toString().toLowerCase().includes(se.toLowerCase())})))).sort(((e,s)=>{if(!xe.key||!xe.direction)return 0;const r=e[xe.key],t=s[xe.key];return null==r||null==t?0:"asc"===xe.direction?r.toString().localeCompare(t.toString()):t.toString().localeCompare(r.toString())})),qe=$e.slice(me*je,(me+1)*je);(0,t.useEffect)((()=>{ge($e.length)}),[$e]);const Oe=te.filter((e=>{const s=Ae.toLowerCase(),r=e.toLowerCase(),t=Ie(e).toLowerCase();return r.includes(s)||t.includes(s)}));return(0,J.jsxs)(l.A,{sx:{backgroundColor:s?"#2D3748":"#F7FAFC",minHeight:"100vh",p:2},className:s?"dark-mode":"",children:[(0,J.jsxs)(l.A,{sx:{padding:"12px",backgroundColor:s?"#1e293b":"#e1f5fe",borderRadius:"8px",marginBottom:"12px",border:"1px solid #ccc",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,J.jsx)(n.A,{variant:"h6",sx:{color:s?"white":"black",fontWeight:"bold"},children:"User Information"}),(0,J.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,J.jsx)(l.A,{ref:Se,sx:{width:ue?ze?120:220:0,height:36,overflow:"hidden",transition:"width 0.3s ease-in-out, opacity 0.3s ease-in-out",display:"flex",alignItems:"center",opacity:ue?1:0},children:(0,J.jsx)(o.Ay,{placeholder:"Search",value:se,onChange:e=>{re(e.target.value),pe(0)},sx:{backgroundColor:s?"#1e293b":"#fff",color:s?"white":"black",px:1.5,height:"100%",fontSize:"0.85rem",borderRadius:1,border:"1px solid "+(s?"#4A5568":"#CBD5E0"),width:"100%",minWidth:0},startAdornment:(0,J.jsx)(_.A,{sx:{mr:1},fontSize:"small"}),endAdornment:se&&(0,J.jsx)(a.A,{size:"small",onClick:()=>{re(""),pe(0)},sx:{color:s?"white":"black"},children:(0,J.jsx)(W.A,{fontSize:"small"})})})}),(0,J.jsx)(i.A,{title:ue?"Close Search":"Search",children:(0,J.jsx)(a.A,{size:"small",onClick:()=>he((e=>!e)),sx:{color:s?"white":"black"},children:ue?(0,J.jsx)(W.A,{fontSize:"small"}):(0,J.jsx)(_.A,{fontSize:"small"})})}),!(ze&&ue)&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(n.A,{sx:{color:s?"white":"black",fontSize:"1rem"},children:"|"}),(0,J.jsx)(i.A,{title:"Column Visibility",children:(0,J.jsx)(a.A,{size:"small",onClick:e=>de(e.currentTarget),sx:{color:s?"white":"black"},children:(0,J.jsx)(F.A,{fontSize:"small"})})}),(0,J.jsx)(n.A,{sx:{color:s?"white":"black",fontSize:"1rem"},children:"|"}),(0,J.jsx)(i.A,{title:"Export to Excel",children:(0,J.jsx)(a.A,{size:"small",onClick:()=>{const e=$e.map((e=>Object.fromEntries(ne.map((s=>[Ie(s),e[s]]))))),s=U.Wp.json_to_sheet(e),r=U.Wp.book_new();U.Wp.book_append_sheet(r,s,"UserReport"),U._h(r,"user_report.xlsx")},sx:{color:s?"white":"black"},children:(0,J.jsx)(v.A,{fontSize:"small"})})}),"admin"===Ee&&(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(n.A,{sx:{color:s?"white":"black",fontSize:"1rem"},children:"|"}),(0,J.jsx)(i.A,{title:"Create User",children:(0,J.jsxs)(c.A,{variant:"contained",onClick:()=>{Q(null),K(!0)},sx:{display:"flex",alignItems:"center",backgroundColor:s?"white":"black",color:s?"black":"white",padding:"2px 6px",textTransform:"none",fontSize:"0.85rem"},children:[(0,J.jsx)(D.A,{sx:{mr:.5,fontSize:15}}),"Create"]})})]})]})]})]}),(0,J.jsxs)(d.A,{anchorEl:ce,open:Fe,onClose:()=>de(null),PaperProps:{sx:{minWidth:200,maxHeight:300,p:1,backgroundColor:s?"#1e293b":"#fff",color:s?"#F7FAFC":"#1e293b",boxShadow:"0px 2px 8px rgba(0, 0, 0, 0.15)",borderRadius:2}},children:[(0,J.jsx)(o.Ay,{autoFocus:!0,placeholder:"Search Columns",value:Ae,onChange:e=>Ce(e.target.value),onKeyDown:e=>e.stopPropagation(),sx:{mb:1,px:1,fontSize:"0.7rem",backgroundColor:s?"#334155":"#f1f5f9",borderRadius:1,width:"100%",height:"28px",color:s?"#F7FAFC":"#1e293b"}}),Oe.map((e=>(0,J.jsx)(u.A,{dense:!0,children:(0,J.jsx)(h.A,{control:(0,J.jsx)(x.A,{size:"small",checked:ne.includes(e),onChange:()=>(e=>{if(ne.includes(e))oe((s=>s.filter((s=>s!==e))));else{const s=te.indexOf(e),r=[...ne];r.splice(s,0,e),oe(r)}})(e)}),label:(0,J.jsx)("span",{style:{fontSize:"0.7rem"},children:Ie(e)})})},e))),(0,J.jsx)(f.A,{sx:{my:1}}),(0,J.jsxs)(u.A,{dense:!0,onClick:()=>{oe(te),ie(te.reduce(((e,s)=>({...e,[s]:Be(s)})),{})),de(null)},children:[(0,J.jsx)(m.A,{children:(0,J.jsx)(z.A,{fontSize:"small"})}),(0,J.jsx)(p.A,{primary:"Reset Columns",primaryTypographyProps:{fontSize:"0.7rem"}})]})]}),(0,J.jsx)("div",{className:"generic-table-container",children:we?(0,J.jsx)(l.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px"},children:(0,J.jsx)(j.A,{sx:{color:s?"#F7FAFC":"#1e293b"}})}):(0,J.jsxs)("table",{className:"generic-table",style:{backgroundColor:s?"#1e293b":"#fff",tableLayout:"fixed"},children:[(0,J.jsx)("thead",{children:(0,J.jsxs)("tr",{children:[(0,J.jsx)("th",{style:{color:s?"white":"#1e293b",width:50,minWidth:50}}),ne.map((e=>(0,J.jsxs)("th",{style:{color:s?"white":"#1e293b",cursor:"pointer",position:"relative",width:ae[e]||Be(e),minWidth:50},onClick:s=>{"resize-handle"!==s.target.className&&(e=>{fe((s=>s.key===e?{key:e,direction:"asc"===s.direction?"desc":"desc"===s.direction?null:"asc"}:{key:e,direction:"asc"})),pe(0)})(e)},children:[(0,J.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingRight:"10px"},children:[(0,J.jsx)("span",{children:Ie(e)}),(0,J.jsxs)(l.A,{sx:{display:"flex",alignItems:"center"},children:[xe.key===e&&"asc"===xe.direction&&(0,J.jsx)(I.A,{fontSize:"small"}),xe.key===e&&"desc"===xe.direction&&(0,J.jsx)(E.A,{fontSize:"small"}),xe.key===e&&null===xe.direction]})]}),(0,J.jsx)("span",{className:"resize-handle",onMouseDown:s=>Te(s,e),style:{position:"absolute",right:0,top:0,height:"100%",width:"5px",cursor:"col-resize",background:s?"#4A5568":"#CBD5E0",display:"flex",alignItems:"center",justifyContent:"center",userSelect:"none"},children:(0,J.jsx)("span",{style:{fontSize:"12px",color:s?"#F7FAFC":"#1e293b"},children:"|"})})]},e)))]})}),(0,J.jsx)("tbody",{children:qe.length>0?qe.map((e=>(0,J.jsxs)("tr",{children:[(0,J.jsx)("td",{style:{color:s?"white":"#1e293b",width:50,minWidth:50},children:(0,J.jsx)(c.A,{onClick:()=>Me(e),size:"small",sx:{color:s?"#F7FAFC":"#1E293B"},children:(0,J.jsx)(T.A,{fontSize:"small"})})}),ne.map((r=>{const t="user_type"===r;return(0,J.jsx)("td",{style:{color:s?"white":"#1e293b",width:ae[r]||Be(r),minWidth:50,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t?(0,J.jsx)("span",{style:{backgroundColor:"student"===e[r]?"#1e88e5":"admin"===e[r]?"#43a047":"#9e9e9e",color:"#fff",padding:"2px 8px",borderRadius:"12px",fontSize:"0.75rem",display:"inline-block",textTransform:"capitalize",whiteSpace:"nowrap"},children:e[r]}):e[r]},r)}))]},e.user_id))):(0,J.jsx)("tr",{children:(0,J.jsx)("td",{colSpan:ne.length+1,className:"no-matching-records",children:0===r.length?"No records found":"No matching records found"})})})]})}),!we&&(0,J.jsx)(l.A,{sx:{display:"flex",justifyContent:"flex-end",mt:2},children:(0,J.jsxs)(l.A,{sx:{display:"flex",alignItems:"center",gap:2,border:"1px solid",borderColor:s?"#4A5568":"#CBD5E0",borderRadius:"8px",padding:"6px 12px",backgroundColor:s?"#2D3748":"#F7FAFC",color:s?"#F7FAFC":"#1e293b"},children:[(0,J.jsx)(n.A,{variant:"caption",sx:{whiteSpace:"nowrap"},children:"Rows per page:"}),(0,J.jsx)(b.A,{value:je,onChange:e=>{be(parseInt(e.target.value)),pe(0)},size:"small",sx:{color:s?"#F7FAFC":"#1e293b",".MuiSelect-icon":{color:s?"#F7FAFC":"#1e293b"},backgroundColor:s?"#4A5568":"#E2E8F0",borderRadius:"4px",fontSize:"0.85rem",minWidth:"60px"},children:[10,15,25,50,100].map((e=>(0,J.jsx)(u.A,{value:e,children:e},e)))}),(0,J.jsxs)(n.A,{variant:"caption",sx:{whiteSpace:"nowrap"},children:[me*je+1,"-",Math.min((me+1)*je,ye)," of ",ye]}),(0,J.jsx)(a.A,{onClick:()=>pe((e=>Math.max(0,e-1))),disabled:0===me,size:"small",sx:{color:s?"#F7FAFC":"#1e293b"},children:(0,J.jsx)(B.A,{fontSize:"small"})}),(0,J.jsx)(a.A,{onClick:()=>pe((e=>(e+1)*je<ye?e+1:e)),disabled:(me+1)*je>=ye,size:"small",sx:{color:s?"#F7FAFC":"#1e293b"},children:(0,J.jsx)(L.A,{fontSize:"small"})})]})}),(0,J.jsx)(A.Ay,{anchor:"right",open:V,onClose:Re,children:(0,J.jsxs)(l.A,{sx:{width:ze?330:500,height:"100%",display:"flex",flexDirection:"column",backgroundColor:s?"#2D3748":"#ffffff"},children:[(0,J.jsx)(l.A,{sx:{p:2,borderBottom:"1px solid #ccc"},children:(0,J.jsx)(n.A,{variant:"h6",sx:{color:s?"#F7FAFC":"#1E293B"},children:G?"Edit User":"Create User"})}),(0,J.jsx)(l.A,{sx:{flex:1,overflowY:"auto",p:2},children:(0,J.jsx)("form",{onSubmit:Pe.handleSubmit,children:(0,J.jsxs)(C.Ay,{container:!0,spacing:2,children:[(0,J.jsx)(C.Ay,{item:!0,xs:12,children:(0,J.jsx)(y.A,{label:"First Name",fullWidth:!0,name:"first_name",value:Pe.values.first_name,onChange:Pe.handleChange,error:Pe.touched.first_name&&Boolean(Pe.errors.first_name),helperText:Pe.touched.first_name&&Pe.errors.first_name,sx:{backgroundColor:s?"#1A202C":"#ffffff","& .MuiInputBase-input":{color:s?"white":"#1e293b"}},InputLabelProps:{style:{color:s?"#ffffff":"#000000"}}})}),(0,J.jsx)(C.Ay,{item:!0,xs:12,children:(0,J.jsx)(y.A,{label:"Last Name",fullWidth:!0,name:"last_name",value:Pe.values.last_name,onChange:Pe.handleChange,error:Pe.touched.last_name&&Boolean(Pe.errors.last_name),helperText:Pe.touched.last_name&&Pe.errors.last_name,sx:{backgroundColor:s?"#1A202C":"#ffffff","& .MuiInputBase-input":{color:s?"white":"#1e293b"}},InputLabelProps:{style:{color:s?"#ffffff":"#000000"}}})}),(0,J.jsx)(C.Ay,{item:!0,xs:12,children:(0,J.jsx)(y.A,{label:"Email Address",fullWidth:!0,name:"email_address",value:Pe.values.email_address,onChange:Pe.handleChange,error:Pe.touched.email_address&&Boolean(Pe.errors.email_address),helperText:Pe.touched.email_address&&Pe.errors.email_address,sx:{backgroundColor:s?"#1A202C":"#ffffff","& .MuiInputBase-input":{color:s?"white":"#1e293b"}},InputLabelProps:{style:{color:s?"#ffffff":"#000000"}}})}),(0,J.jsx)(C.Ay,{item:!0,xs:12,children:(0,J.jsx)(y.A,{label:"Password",fullWidth:!0,name:"password",type:"password",value:Pe.values.password,onChange:Pe.handleChange,error:Pe.touched.password&&Boolean(Pe.errors.password),helperText:Pe.touched.password&&Pe.errors.password,sx:{backgroundColor:s?"#1A202C":"#ffffff","& .MuiInputBase-input":{color:s?"white":"#1e293b"}},InputLabelProps:{style:{color:s?"#ffffff":"#000000"}}})}),(0,J.jsx)(C.Ay,{item:!0,xs:12,children:(0,J.jsx)(y.A,{label:"User Type",value:G?G.user_type:"admin",disabled:!0,fullWidth:!0,sx:{backgroundColor:s?"#1A202C":"#ffffff","& .MuiInputBase-input":{color:s?"white":"#1E293B"},"& .MuiInputBase-input.Mui-disabled":{WebkitTextFillColor:s?"white":"#1E293B"}},InputLabelProps:{style:{color:s?"#ffffff":"#000000"}}})})]})})}),(0,J.jsx)(f.A,{}),(0,J.jsxs)(l.A,{sx:{p:2,display:"flex",justifyContent:"space-between",marginTop:"auto"},children:[(0,J.jsxs)(l.A,{sx:{display:"flex",gap:1},children:[(0,J.jsx)(c.A,{onClick:Re,startIcon:(0,J.jsx)(P.A,{}),size:"small",variant:"outlined",sx:{borderColor:s?"#F7FAFC":"#1E293B",color:s?"#F7FAFC":"#1E293B"},children:"Close"}),G&&"student"!==Ee&&(0,J.jsx)(c.A,{onClick:()=>{ee(!0)},startIcon:(0,J.jsx)(N.A,{}),size:"small",color:"error",variant:"outlined",sx:{borderColor:s?"#F7FAFC":"#1E293B"},children:"Delete"})]}),(0,J.jsx)(c.A,{onClick:Pe.handleSubmit,startIcon:G?(0,J.jsx)(M.A,{}):(0,J.jsx)(D.A,{}),variant:"contained",size:"small",sx:{backgroundColor:"#1976d2",color:"white"},children:G?"Save":"Create"})]})]})}),(0,J.jsxs)(g.A,{open:Z,onClose:Ne,children:[(0,J.jsx)(w.A,{children:"Confirm Deletion"}),(0,J.jsx)(k.A,{children:"Are you sure you want to delete this user?"}),(0,J.jsxs)(S.A,{children:[(0,J.jsx)(c.A,{onClick:Ne,color:"primary",children:"Cancel"}),(0,J.jsx)(c.A,{onClick:async()=>{if(G){ke(!0);try{await fetch(`${X}/users/${G.user_id}`,{method:"DELETE"}),O((e=>e.filter((e=>e.user_id!==G.user_id)))),ee(!1),K(!1)}catch(e){console.error("Failed to delete user:",e)}finally{ke(!1)}}},color:"error",children:"Delete"})]})]})]})}},68654:()=>{}}]);
//# sourceMappingURL=188.93efcb9e.chunk.js.map